<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Expense Tracker Dashboard</title>
<link rel="stylesheet" href="main.css">
</head>
<body>

<nav>
  <h3>Expense Tracker</h3>
  <button id="logoutBtn">Logout</button>
</nav>

<section>
 
  
  <div class="dashboard">
    
    
    <div class="stats">
      <div class="card">
        <h3>Total Income</h3>v
        <p id="totalIncome">₹0</p>
      </div>

      <div class="card">
        <h3>Total Expense</h3>
        <p id="totalExpense">₹0</p>
      </div>

      <div class="card">
        <h3>Balance</h3>
        <p id="balance">₹0</p>
      </div>
    </div>

   
    <div class="form-section">
      <h2>Add Transaction</h2>

      <form id="transactionForm">
        <input type="number" id="amount" placeholder="Enter Amount" required />

        <select id="transactionType" required>
          <option value="" disabled selected>Transaction Type</option>
          <option value="income">Income</option>
          <option value="expense">Expense</option>
        </select>

        <select id="category" required>
          <option value="" disabled selected>Category</option>
          <option>Salary</option>
          <option>Business</option>
          <option>Shopping</option>
          <option>Food</option>
          <option>Travel</option>
        </select>

        <select id="status" required>
          <option value="" disabled selected>Status</option>
          <option>Completed</option>
          <option>Pending</option>
        </select>

        <button type="submit">Add Record</button>
      </form>
    </div>

    
    <table>
      <thead>
        <tr>
          <th>Amount</th>
          <th>Type</th>
          <th>Category</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody id="recordTable"></tbody>
    </table>

  </div>
</section>

<script>

const user = JSON.parse(localStorage.getItem("user"));
if (!user) {
  alert("Please login first!");
  window.location.href = "login.html";
}


const recordTable = document.getElementById("recordTable");
const totalIncomeEl = document.getElementById("totalIncome");
const totalExpenseEl = document.getElementById("totalExpense");
const balanceEl = document.getElementById("balance");


document.getElementById("logoutBtn").onclick = () => {
  localStorage.removeItem("user");
  window.location.href = "login.html";
};


async function loadTransactions() {
  try {
    const res = await fetch("http://localhost:5000/get-transactions", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email: user.email })
    });
    const result = await res.json();

    if (!result.success) {
      alert(result.message);
      return;
    }

    const transactions = result.data;
    let income = 0, expense = 0;
    recordTable.innerHTML = "";

    transactions.forEach(t => {
      const row = document.createElement("tr");
      const date = new Date(t.date).toLocaleDateString();

      row.innerHTML = `
        <td>₹${Number(t.amount).toLocaleString('en-IN')}</td>
        <td><span class="badge ${t.type}">${t.type.toUpperCase()}</span></td>
        <td>${t.category}</td>
        <td><span class="status ${t.status.toLowerCase()}">${t.status}</span></td>
        <td>${date}</td>
        <td><button onclick="deleteTransaction('${t._id}')" class="delete-btn">Delete</button></td>
      `;
      recordTable.appendChild(row);

      if (t.type === "income") income += Number(t.amount);
      else expense += Number(t.amount);
    });

    totalIncomeEl.textContent = "₹" + income.toLocaleString('en-IN');
    totalExpenseEl.textContent = "₹" + expense.toLocaleString('en-IN');
    const balance = income - expense;
    balanceEl.textContent = "₹" + balance.toLocaleString('en-IN');
    balanceEl.style.color = balance >= 0 ? "#27ae60" : "#e74c3c";

  } catch (err) {
    console.error(err);
    alert("Failed to load data");
  }
}


document.getElementById("transactionForm").onsubmit = async (e) => {
  e.preventDefault();

  const amount = document.getElementById("amount").value;
  const type = document.getElementById("transactionType").value;
  const category = document.getElementById("category").value;
  const status = document.getElementById("status").value;

  try {
    const res = await fetch("http://localhost:5000/add-transaction", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email: user.email, amount, type, category, status })
    });

    const data = await res.json();
    if (data.success) {
      alert("Transaction added!");
      e.target.reset();
      loadTransactions();
    } else {
      alert(data.message);
    }
  } catch (err) {
    alert("Error adding transaction");
  }
};


async function deleteTransaction(id) {
  if (!confirm("Delete this transaction?")) return;

  const res = await fetch("http://localhost:5000/delete-transaction", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ id, email: user.email })
  });

  const data = await res.json();
  if (data.success) loadTransactions();
  else alert("Delete failed");
}


loadTransactions();

</script>

</body>
</html>
